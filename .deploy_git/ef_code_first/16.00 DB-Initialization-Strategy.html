<!DOCTYPE html>
<html lang=en>
<head><meta name="generator" content="Hexo 3.9.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Code First 中数据库初始化策略00.00 Code First 中支持 4 种数据库初始化策略 CreateDatabaseIfNotExists 这是默认的初始化程序。顾名思义，如果没有配置，它将创建数据库。但是，如果更改模型类，然后使用该初始化程序运行应用程序，那么它将抛出异常   DropCreateDatabaseIfModelChanges 如果您的模型类（实体类）已更改，则此">
<meta name="keywords" content="go,.net">
<meta property="og:type" content="website">
<meta property="og:title" content="Bogerv">
<meta property="og:url" content="http://bogerv.wang/ef_code_first/16.00 DB-Initialization-Strategy.html">
<meta property="og:site_name" content="Bogerv">
<meta property="og:description" content="Code First 中数据库初始化策略00.00 Code First 中支持 4 种数据库初始化策略 CreateDatabaseIfNotExists 这是默认的初始化程序。顾名思义，如果没有配置，它将创建数据库。但是，如果更改模型类，然后使用该初始化程序运行应用程序，那么它将抛出异常   DropCreateDatabaseIfModelChanges 如果您的模型类（实体类）已更改，则此">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2020-11-25T17:39:58.878Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Bogerv">
<meta name="twitter:description" content="Code First 中数据库初始化策略00.00 Code First 中支持 4 种数据库初始化策略 CreateDatabaseIfNotExists 这是默认的初始化程序。顾名思义，如果没有配置，它将创建数据库。但是，如果更改模型类，然后使用该初始化程序运行应用程序，那么它将抛出异常   DropCreateDatabaseIfModelChanges 如果您的模型类（实体类）已更改，则此">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Bogerv</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">    
    <div class="content index py4">
        
          <header id="header">
  <a href="/">
  
    
      <div id="logo" style="background-image: url(/images/logo.png);"></div>
    
  
    <div id="title">
      <h1>Bogerv</h1>
    </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#"><i class="fas fa-bars fa-2x"></i></a>
      </li>
       
        <li><a href="/">Home</a></li>
       
        <li><a href="/categories/go/">Go</a></li>
       
        <li><a href="/categories/rust/">Rust</a></li>
       
        <li><a href="/categories/dotnet/">.Net</a></li>
       
        <li><a href="/categories/">Categories</a></li>
       
        <li><a href="/archives/">Archives</a></li>
       
        <li><a href="/about/">About</a></li>
       
        <li><a href="/search/">Search</a></li>
      
    </ul>
  </div>
</header>

        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  

  <div class="content" itemprop="articleBody">
      
          <h1 id="Code-First-中数据库初始化策略"><a href="#Code-First-中数据库初始化策略" class="headerlink" title="Code First 中数据库初始化策略"></a>Code First 中数据库初始化策略</h1><h2 id="00-00-Code-First-中支持-4-种数据库初始化策略"><a href="#00-00-Code-First-中支持-4-种数据库初始化策略" class="headerlink" title="00.00 Code First 中支持 4 种数据库初始化策略"></a>00.00 Code First 中支持 4 种数据库初始化策略</h2><ul>
<li>CreateDatabaseIfNotExists<blockquote>
<p>这是默认的初始化程序。顾名思义，如果没有配置，它将创建数据库。但是，如果更改模型类，然后使用该初始化程序运行应用程序，那么它将抛出异常</p>
</blockquote>
</li>
<li>DropCreateDatabaseIfModelChanges<blockquote>
<p>如果您的模型类（实体类）已更改，则此初始化程序将删除现有数据库并创建新数据库。因此，当您的模型类更改时，您无需担心维护数据库模式</p>
</blockquote>
</li>
<li>DropCreateDatabaseAlways<blockquote>
<p>顾名思义，该初始化程序在每次运行应用程序时都会删除现有数据库，而不管您的模型类是否已更改。当您需要新鲜数据库时，每次运行应用程序时，就像在开发应用程序时一样</p>
</blockquote>
</li>
<li>Custom DB Initializer<blockquote>
<p>您还可以创建自己的自定义初始化程序，如果上述任何一个都不满足您的要求，或者您想使用上述初始化程序初始化数据库的其他进程</p>
</blockquote>
</li>
</ul>
<h2 id="01-00-使用方法"><a href="#01-00-使用方法" class="headerlink" title="01.00 使用方法"></a>01.00 使用方法</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">YourDBContext</span>: <span class="title">DbContext</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">YourDBContext</span>(<span class="params"></span>): <span class="title">base</span>(<span class="params"><span class="string">"YourDBConnectionString"</span></span>) </span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Database.SetInitializer&lt;YourDBContext&gt;(<span class="keyword">new</span> CreateDatabaseIfNotExists&lt;YourDBContext&gt;());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Database.SetInitializer&lt;YourDBContext&gt;(new DropCreateDatabaseIfModelChanges&lt;YourDBContext&gt;());</span></span><br><span class="line">        <span class="comment">//Database.SetInitializer&lt;YourDBContext&gt;(new DropCreateDatabaseAlways&lt;YourDBContext&gt;());</span></span><br><span class="line">        <span class="comment">//Database.SetInitializer&lt;YourDBContext&gt;(new YourDBInitializer());</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> DbSet&lt;Student&gt; Students &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> DbSet&lt;Standard&gt; Standards &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="02-00-创建自己的初始化器"><a href="#02-00-创建自己的初始化器" class="headerlink" title="02.00 创建自己的初始化器"></a>02.00 创建自己的初始化器</h2><p>可以继承 4 种中的任意一种来实现自己的初始化器</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class YourDBInitializer :  CreateDatabaseIfNotExists&lt;YourDBContext&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Seed</span>(<span class="params">YourDBContext context</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">base</span>.Seed(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="03-00-在配置文件设置数据库初始化器"><a href="#03-00-在配置文件设置数据库初始化器" class="headerlink" title="03.00 在配置文件设置数据库初始化器"></a>03.00 在配置文件设置数据库初始化器</h2><p>在 app.config 中设置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appSettings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">"DatabaseInitializerForType YourDataLayer.YourDBContext, YourDataLayer"</span>         </span></span><br><span class="line"><span class="tag">        <span class="attr">value</span>=<span class="string">"System.Data.Entity.DropCreateDatabaseAlways`1[[YourDataLayer.YourDBContext, YourDataLayer]], EntityFramework"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appSettings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在配置文件中使用自己的初始化器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appSettings</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">"DatabaseInitializerForType YourDataLayer.YourDBContext, YourDataLayer"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">value</span>=<span class="string">"YourDataLayer.YourDBInitializer, YourDataLayer"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appSettings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="04-00-Code-First-中关闭数据库初始化器"><a href="#04-00-Code-First-中关闭数据库初始化器" class="headerlink" title="04.00 Code First 中关闭数据库初始化器"></a>04.00 Code First 中关闭数据库初始化器</h2><p>在生产环境中, 你不想丢失已经存在的数据, 那么你可以关闭初始化器</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">YourDBContext</span>: <span class="title">DbContext</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">YourDBContext</span>(<span class="params"></span>) : <span class="title">base</span>(<span class="params"><span class="string">"YourDBContextDBConnectionString"</span></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;            </span><br><span class="line">        <span class="comment">//Disable initializer</span></span><br><span class="line">        Database.SetInitializer&lt;YourDBContext&gt;(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> DbSet&lt;Student&gt; Students &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> DbSet&lt;Standard&gt; Standards &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在配置文件中关闭初始化器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appSettings</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">add</span> <span class="attr">key</span>=<span class="string">"DatabaseInitializerForType YourDataLayer.YourDBContext, YourDataLayer"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">value</span>=<span class="string">"Disabled"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appSettings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
        
  </div>
</article>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2017-2020
    Bogerv
    <a href="http://beian.miit.gov.cn/" target="_blank">京ICP备20022301号-1</a>
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/categories/go/">Go</a></li>
         
          <li><a href="/categories/rust/">Rust</a></li>
         
          <li><a href="/categories/dotnet/">.Net</a></li>
         
          <li><a href="/categories/">Categories</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

    <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<!-- clipboard -->

<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
